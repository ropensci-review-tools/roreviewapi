<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Debugging the package check API • roreviewapi</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Debugging the package check API">
<meta property="og:description" content="roreviewapi">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">roreviewapi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.2.019</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/debugging.html">Debugging the package check API</a>
    </li>
    <li>
      <a href="../articles/endpoints.html">API Endpoints</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropensci-review-tools/roreviewapi/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="debugging_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Debugging the package check API</h1>
                        <h4 class="author">Mark Padgham</h4>
            
            <h4 class="date">2021-10-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci-review-tools/roreviewapi/blob/master/vignettes/debugging.Rmd"><code>vignettes/debugging.Rmd</code></a></small>
      <div class="hidden name"><code>debugging.Rmd</code></div>

    </div>

    
    
<p>The main API endpoint for the Digital Ocean server is the <a href="https://docs.ropensci.org/roreviewapi/articles/endpoints.html#editorcheck"><code>editorcheck</code></a>, called by the <code>ropensci-review-bot</code> on every submission, and also manually (re-)triggered by the command <code>@ropensci-review-bot check package</code>. This vignette describes procedures which may be used to debug any instances in which package checks fail.</p>
<p>Most failures at the server end will deliver HTTP error codes of “500” <a href="https://github.com/ropensci/software-review/issues/463#issuecomment-920941332">like this example</a>. This code <em>may</em> indicate that the server is currently unavailable, which will arise once per week during rebuild and redeploy processes, scheduled every Monday at 23:59 UTC. If a submission happens to be roughly at this time, the recommended procedure is to wait at least an hour before manually trying <code>@ropensci-review-bot check package</code>. Other 500 codes should be reported straight to maintainers of the check system, currently to <a href="https://github.com/mpadge">@mpadge</a> and <a href="https://github.com/noamross">@noamross</a> as respective first and second points of contact. This vignette describes the procedures they would follow to debug any problems.</p>
<p>Debugging generally requires stepping through the code as called by the main <a href="https://github.com/ropensci-review-tools/roreviewapi/blob/main/R/plumber.R"><code>editorcheck</code> endpoint</a>, and into the <a href="https://github.com/ropensci-review-tools/roreviewapi/blob/main/R/editor-check.R"><code>editor_check()</code> function</a> called by the endpoint as a background process.</p>
<div id="debugging-procedure" class="section level1">
<h1 class="hasAnchor">
<a href="#debugging-procedure" class="anchor"></a>Debugging Procedure</h1>
<div id="check-that-the-api-is-online" class="section level2">
<h2 class="hasAnchor">
<a href="#check-that-the-api-is-online" class="anchor"></a>Check that the API is online</h2>
<p>The following code will confirm that the API is online, by returning a single numeric value:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/GET.html">GET</a></span> <span class="op">(</span><span class="st">"http://&lt;ip-address&gt;:8000/mean"</span><span class="op">)</span> |&gt;
    <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/content.html">content</a></span> <span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="check-log-of-recent-requests" class="section level2">
<h2 class="hasAnchor">
<a href="#check-log-of-recent-requests" class="anchor"></a>Check log of recent requests</h2>
<p>The log entries are illustrated in the <a href="https://docs.ropensci.org/roreviewapi/articles/endpoints.html#5-log">endpoints vignette</a>, and can be used to ensure that all variables were successfully delivered in the request. Any missing or malformed variables most likely indicate problems with the submission template. These should be caught by the initial call make by the <a href="https://github.com/ropensci-review-tools/roreviewapi/blob/82c9724a712094e4ccabb3974cb952f68ad5180f/R/plumber.R#L23"><code>editorcheck</code> function to the <code>check_issue_template()</code> function</a>. Potential issues can be debugged by calling that function locally:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>roreviewapi<span class="op">::</span><span class="kw">check_issue_template</span> (<span class="dt">orgrepo =</span> <span class="st">"ropensci/software-review"</span>,</span>
<span id="cb2-2"><a href="#cb2-2"></a>                                   <span class="dt">issue_num =</span> <span class="op">&lt;</span>issue_num<span class="op">&gt;</span>)</span></code></pre></div>
<p>That should return an empty string with an additional attribute, <code>"proceed_with_checks"</code>, which should be <code>TRUE</code>. Any other return value indicates an issue with the submission template, for which the return value should contain text describing the problem.</p>
</div>
<div id="check-installation-of-system-dependencies" class="section level2">
<h2 class="hasAnchor">
<a href="#check-installation-of-system-dependencies" class="anchor"></a>Check installation of system dependencies</h2>
<p>This and the following checks are components of the <a href="https://github.com/ropensci-review-tools/roreviewapi/blob/main/R/editor-check.R"><code>editor_check()</code> function</a> called by the main endpoint as a background process, the first step of which is to identify and install system dependencies. This step is error prone, as is also the case on all CRAN machines. A final step of the check is to identify any packages which were unable to be installed, and to post a list of these directly in the submission issue. Such instances should generally be temporary, and fixed by forthcoming CRAN updates. These happen because of temporary breakages in one package which lead to other packages becoming unable to be installed from CRAN, with these temporary breakages in turn generally arising because of changes to external (non-R) system libraries. If any notified inabilities to install packages adversely affect final check results, debugging may require manually running checks on the Digital Ocean server, as described in the final section below.</p>
</div>
<div id="check-system-output-and-error-logs" class="section level2">
<h2 class="hasAnchor">
<a href="#check-system-output-and-error-logs" class="anchor"></a>Check system output and error logs</h2>
<p>The system output and error logs from checks for a specified package are accessible from <a href="https://docs.ropensci.org/roreviewapi/articles/endpoints.html#7-stdlogs">the <code>stdlogs</code> endpoint</a>, which requires the single parameter of the <code>repourl</code> of the repository being checked. Logs are kept for the latest git head, and are accessible if and only if the latest GitHub commit matches the points at which the logs were generated. In those cases, the return value may offer useful diagnostic insights into potential problems either with submitted packages, or the check system itself.</p>
</div>
</div>
<div id="manually-running-checks" class="section level1">
<h1 class="hasAnchor">
<a href="#manually-running-checks" class="anchor"></a>Manually running checks</h1>
<p>If all else fails, checks can be manually run directly from the Digital Ocean server, and sent straight to the relevant issue. The following procedure describe how, generally following the main <a href="https://github.com/ropensci-review-tools/roreviewapi/blob/main/R/editor-check.R"><code>editor_check()</code> function</a>.</p>
<ol style="list-style-type: decimal">
<li>Enter the <code>roreviewapi</code> Docker image via <code>docker -it --rm --entrypoint /bin/bash roreviewapi</code> and start R.</li>
<li>Set <code>repourl &lt;- &lt;url&gt;</code> and run <code>path &lt;- roreviewapi::dl_gh_repo (repourl)</code> to download a clone of the repository.</li>
<li>Type <code>os &lt;- "ubuntu"</code> and <code>os_release &lt;- "20.04"</code>.</li>
<li>Run <code>p &lt;- roreviewapi::pkgrep_install_deps (path, os, os_release)</code>. The value, <code>p</code>, will list any packages which were unable to be installed. These will then need to be manually installed, generally through finding the remote/dev URLs for the packages, and running <code><a href="https://remotes.r-lib.org/reference/install_github.html">remotes::install_github()</a></code> or similar. Note that successful installation may only be possible in a particular order, and in the worst cases may be a process of trial and error.</li>
<li>Finally generate the main checks by running <code>checks &lt;- pkgcheck::pkgcheck(path)</code>, during which diagnostic output will be dumped directly to the screen.</li>
<li>Convert checks to markdown format by running <code>out &lt;- roreviewapi::collate_editor_check (checks)</code>.</li>
<li>Finally, post the checks to the desired issue with <code>out &lt;- roreviewapi::post_to_issue (out, orgrepo, issue_num)</code>. Alternative values for <code>orgrepo</code> and <code>issue_num</code> can be used to first confirm that the checks look okay before posting them to <code>ropensci/software-review</code>.</li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Mark Padgham.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
